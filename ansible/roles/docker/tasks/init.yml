
- name: Check if /etc/init exists
  stat: path=/etc/init/
  register: etc_init

- name: Docker upstart default config file
  become: yes
  template: src=docker-defaults.j2 dest=/etc/default/docker
  when: etc_init.stat.exists == true
  notify: 
    - Restart Docker

- name: Docker init file
  become: yes
  template: src=docker-init.j2 dest=/etc/init/docker.conf
  when: etc_init.stat.exists == true
  notify: 
    - Restart Docker

- name: Check if systemd exists
  become: yes
  stat: path=/usr/lib/systemd/system/
  register: systemd_check

- name: Docker systemd default config file
  become: yes
  template: src=docker-sysconfig.j2 dest=/etc/sysconfig/docker
  register: sysconfig_file
  when: systemd_check.stat.exists == true
  notify:
    - Restart Docker
  
- name: Docker systemd file
  become: yes
  template: src=docker-service.j2 dest=/lib/systemd/system/docker.service backup=yes
  register: service_file
  when: systemd_check.stat.exists == true
  notify:
    - Restart Docker

  - name: reload systemd
    become: yes
    shell: systemctl daemon-reload
#    when: service_file.changed or sysconfig_file.changed
    notify:
    - Restart Docker
  - meta: flush_handlers